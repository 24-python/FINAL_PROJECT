{% extends 'base.html' %}

{% block title %}Оформление заказа - {{ block.super }}{% endblock %}
{% block content %}
<h2 class="mb-4">Оформление заказа</h2>
<!-- --- Добавлен id="checkout-form" --- -->
<form method="post" id="checkout-form">
    {% csrf_token %}
    <div class="row g-3">
        <div class="col-md-6">
            <label for="{{ form.delivery_address.id_for_label }}" class="form-label">Адрес доставки</label>
            {{ form.delivery_address }}
            {% if form.delivery_address.errors %}
                <div class="alert alert-danger mt-1">{{ form.delivery_address.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.delivery_phone.id_for_label }}" class="form-label">Телефон</label>
            {{ form.delivery_phone }}
            {% if form.delivery_phone.errors %}
                <div class="alert alert-danger mt-1">{{ form.delivery_phone.errors }}</div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <label for="{{ form.delivery_date.id_for_label }}" class="form-label">Дата доставки</label>
            {{ form.delivery_date }}
            <!-- --- Добавлен id="delivery_date_error" --- -->
            {% if form.delivery_date.errors %}
                <div class="alert alert-danger mt-1" id="delivery_date_error">{{ form.delivery_date.errors }}</div>
            {% else %}
                <!-- --- Добавим пустой div с id, если ошибки нет, для безопасности скрипта --- -->
                <div id="delivery_date_error" style="display: none;"></div>
            {% endif %}
            <!-- --- /Добавлен id="delivery_date_error" --- -->
        </div>
    </div>
    <div class="mt-3">
        <button type="submit" class="btn btn-success">Оформить заказ</button>
        <a href="{% url 'shop:cart' %}" class="btn btn-secondary ms-2">Назад в корзину</a>
    </div>
</form>
<!-- --- /Добавлен id="checkout-form" --- -->

<script>
document.addEventListener('DOMContentLoaded', function () {
    const deliveryDateInput = document.getElementById('{{ form.delivery_date.id_for_label }}');
    const errorDiv = document.getElementById('delivery_date_error');
    const form = document.getElementById('checkout-form');

    // Проверяем, есть ли ошибка у поля даты при загрузке страницы
    if (errorDiv && errorDiv.textContent.trim() !== '') {
        // Показываем alert с сообщением об ошибке
        alert("Ошибка: " + errorDiv.textContent.trim());
        // Очищаем значение поля даты
        deliveryDateInput.value = '';
        // Фокус на поле для удобства
        deliveryDateInput.focus();
    }

    // Также можно добавить проверку перед отправкой формы (на всякий случай)
    form.addEventListener('submit', function(e) {
        if (deliveryDateInput.value && new Date(deliveryDateInput.value) < new Date()) {
            e.preventDefault(); // Останавливаем отправку
            alert("Дата доставки не может быть в прошлом. Пожалуйста, выберите корректную дату.");
            deliveryDateInput.value = ''; // Очищаем поле
            deliveryDateInput.focus(); // Фокус на поле
        }
    });
});
</script>
{% endblock %}